
clc

% Controls are here
bass = 0.9;
mid = 0.9;
treble = 0.9;

% Resistors
R1 = 1e3; % R-in
RO = 1e6; % R-out
R2 = 33e3; % resistor in stack
T = 220e3;
M = 25e3;
B = 1e6;

% Capacitors
c1 = 470e-12;
c2 = 22e-9;
c3 = 22e-9;
c4 = 20e-6;


T1 = T*treble;
T2 = T*(1-treble);
B = B*bass;
M1 = M*mid;
M2 = M*(1-mid);



% numerator

% s^0
b(1) = 0;

% s^1
b(2) = (B*c1 + B*c2 + c1*M1 + c2*M1 + c3*M1 + c1*M2 + c2*M2 + c1*T1);

% s^2
b(3) = (B*c1*c3*M1 + B*c2*c3*M1 + c1*c3*M1*M2 + c2*c3*M1*M2 + ...
    B*c1*c3*R2 + c1*c3*M1*R2 + c1*c2*M2*R2 + c1*c3*M2*R2 + ...
    c1*c3*M1*T1 + c1*c2*M2*T1 + c1*(c2 + c3)*R2*T1 + c1*c3*M1*T2 + ...
    c1*c2*M2*T2 + B*c1*c2*(R2 + T1 + T2) + ...
    c1*c2*M1*(R2 + T1 + T2));

% s^3
b(4) = (B*c1*c2*c3*R2*T1 + c1*c2*c3*M2*R2*T1 + ...
   B*c1*c2*c3*M1*(R2 + T1 + T2) + c1*c2*c3*M1*M2*(R2 + T1 + T2))

% denominator

%s^0
a(1) = B + M1 + M2 + RO + T1;

%s^1
a(2) = (B*c3*M1 + c3*M1*M2 + B*c3*R1 + c3*M1*R1 + c1*M2*R1 + c2*M2*R1 + ...
    B*c3*R2 + c3*M1*R2 + c2*M2*R2 + c3*M1*RO + c1*M2*RO + c2*M2*RO + ...
    c1*R1*RO + B*c1*(R1 + RO) + c1*M1*(R1 + RO) + c3*M1*T1 + ...
    c2*M2*T1 + c1*R1*T1 + c2*(R1 + R2)*(RO + T1) + ...
    c3*(R1 + R2)*(M2 + RO + T1) + B*c2*(R1 + R2 + RO + T1) + ...
    c2*M1*(R1 + R2 + RO + T1) + B*c1*T2 + c1*M1*T2 + c1*M2*T2 + ...
    c1*T1*T2 + c1*RO*(T1 + T2));

%s^2
a(3) = (B*c1*c3*M1*R1 + c1*c3*M1*M2*R1 + B*c1*c3*R1*R2 + c1*c2*M2*R1*R2 + ...
	B*c1*c3*M1*RO + c1*c3*M1*M2*RO + B*c1*c3*R1*RO + B*c1*c3*R2*RO + ...
	c1*c2*M2*R2*RO + c1*c2*M2*R1*T1 + B*c1*c2*(R1 + RO)*(R2 + T1) + ...
	c1*c2*M1*(R1 + RO)*(R2 + T1) + c2*c3*M2*R1*(RO + T1) + ...
	c2*c3*M2*R2*(RO + T1) + B*c2*c3*(R1 + R2)*(RO + T1) + ...
	B*c2*c3*M1*(R1 + R2 + RO + T1) + c2*c3*M1*M2*(R1 + R2 + RO + T1) + ...
	B*c1*c3*M1*T2 + c1*c3*M1*M2*T2 + B*c1*c3*R1*T2 + c1*c2*M2*R1*T2 + ...
	B*c1*c3*R2*T2 + c1*c2*M2*R2*T2 + c1*c2*M2*T1*T2 + ...
	B*c1*c2*(R1 + R2 + RO + T1)*T2 + c1*c2*M1*(R1 + R2 + RO + T1)*T2 + ...
	c1*(c2 + c3)*R1*T1*(R2 + T2) + c1*c3*M2*R2*(RO + T2) + ...
	c1*c3*M2*R1*(R2 + RO + T2) + c1*c2*M2*RO*(T1 + T2) + ...
	c1*(c2 + c3)*R1*RO*(R2 + T1 + T2) + ...
	c1*c3*M1*((R1 + RO)*(R2 + T1) + (R1 + R2 + RO + T1)*T2) + ...
	c1*(c2 + c3)*R2*(T1*T2 + RO*(T1 + T2)));

%s^3
a(4) = (B*c1*c2*c3*R1*RO*T1 + c1*c2*c3*M2*R1*RO*T1 + ...
	B*c1*c2*c3*R2*RO*T1 + c1*c2*c3*M2*R2*RO*T1 + ...
	B*c1*c2*c3*M1*(R1 + RO)*(R2 + T1) + ...
	c1*c2*c3*M1*M2*(R1 + RO)*(R2 + T1) + B*c1*c2*c3*R1*R2*(RO + T1) + ...
	c1*c2*c3*M2*R1*R2*(RO + T1) + B*c1*c2*c3*R1*(RO + T1)*T2 + ...
	c1*c2*c3*M2*R1*(RO + T1)*T2 + B*c1*c2*c3*R2*(RO + T1)*T2 + ...
	c1*c2*c3*M2*R2*(RO + T1)*T2 + ...
	B*c1*c2*c3*M1*(R1 + R2 + RO + T1)*T2 + ...
	c1*c2*c3*M1*M2*(R1 + R2 + RO + T1)*T2)

s = tf('s');

sys = RO*( b(4)*s^3 + b(3)*s^2 + b(2)*s + b(1) ) / ( a(4)*s^3 + a(3)*s^2 + a(2)*s + a(1) )

P = bodeoptions;
XLimMode = 'manual';
P.XLim = [10 30000];
P.FreqUnits = 'Hz'; % Create plot with the options specified by P
h = bodeplot(sys,P);  
